import*as inquirer from"@inquirer/prompts";import{Impl}from"#protocol/onebot/v11";import{promiseEvent}from"#util";import*as Common from"../common.js";import*as Philia from"../philia.js";export class Project extends Common.Project{server;client;static async createConfig(r){let i=await inquirer.select({message:`请选择 OneBotv11 协议类型`,choices:[{name:`正向 WebSocket`,value:`ws`},{name:`反向 WebSocket`,value:`ws-reverse`}]}),a=await(i===`ws`?inquirer.input({message:`请输入 OneBotv11 服务器地址:`,default:`ws://localhost:2536`,required:!0}):inquirer.number({message:`请输入 OneBotv11 服务器监听端口:`,min:1,max:65535,required:!0}));return{name:r,server:{type:i,path:a},philia:await Philia.Project.createConfig(`App`,i===`ws-reverse`?`Client`:void 0)}}verifyConfig(){switch(this.config.server.type){case`ws`:if(typeof this.config.server.path!=`string`)throw TypeError(`OneBotv11 服务器地址必须为字符串`);break;case`ws-reverse`:if(typeof this.config.server.path!=`number`||this.config.server.path<1||this.config.server.path>65535)throw TypeError(`OneBotv11 服务器监听端口必须为1-65535`);break;default:throw TypeError(`OneBotv11 协议类型必须为 ws 或 ws-reverse`)}}start(){return this.config.server.type===`ws`?(this.client=new Impl.Client(this.logger,this.config.philia,this.config.server.path),promiseEvent(this.client.ws,`open`,`error`)):(this.server=new Impl.Server(this.logger,this.config.philia,this.config.server.path),promiseEvent(this.server.wss,`listening`,`error`))}stop(){return this.config.server.type===`ws`?this.client?.close():this.server?.close()}}