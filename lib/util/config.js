import fs from"node:fs/promises";import YAML from"yaml";const map=new Map;export default async function makeConfig(r,i,a={},o={}){if(map.has(r))return map.get(r);let s=`${r}.yml`,c=typeof o.replacer==`function`?async()=>fs.writeFile(s,await o.replacer(YAML.stringify(i)),`utf8`):()=>fs.writeFile(s,YAML.stringify(i),`utf8`),l={config:i,configSave:c};map.set(r,l);let u={};try{u=YAML.parse(await fs.readFile(s,`utf8`)),Object.assign(i,u)}catch{}return Object.assign(i,a),YAML.stringify(i)!==YAML.stringify(u)&&await c(),l}