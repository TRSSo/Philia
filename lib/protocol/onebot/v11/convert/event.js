import{makeError}from"#util";import*as Message from"./message.js";export class OBv11toPhilia{client;event_map=new Map;constructor(e){this.client=e}convert(t){if(typeof this[t.post_type]==`function`)return this[t.post_type](t);throw makeError(`未知事件: ${t.post_type}`,{event:t})}async message(e){let n=await new Message.OBv11toPhilia(this.client,e).convert(),r={raw:e,id:String(e.message_id),time:e.time,type:`message`,scene:`user`,message:n.after,summary:n.summary};return e.message_type===`group`?(r.scene=`group`,r.user=this.client.handle._convertGroupMemberInfo(String(e.group_id),e.sender),r.group=await this.client.handle.getGroupInfo({id:String(e.group_id)})):r.user=this.client.handle._convertUserInfo(e.sender),r}message_sent(e){return this.message(e)}notice(e){return e}async request(e){let t={raw:e,id:e.flag,type:`request`,scene:`user_add`,time:e.time,user:await this.client.handle.getUserInfo({id:String(e.user_id)}),state:`pending`,reason:e.comment};return e.request_type===`group`&&(t.scene=`group_${e.sub_type}`,t.group=await this.client.handle.getGroupInfo({id:String(e.group_id)})),this.event_map.set(t.id,t),t}meta_event(e){return e}}